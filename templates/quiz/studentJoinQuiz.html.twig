<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport"
          content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.5.0/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="{{ asset('assetsUser/assetsQuiz/teacherLaunchQuiz.css') }}">
    <script src="{{ asset('assetStudent/vendor/jquery/jquery.min.js') }}"></script>

    <script src="{{ asset('assetStudent/vendor/bootstrap/js/bootstrap.bundle.min.js') }}"></script>

    <script src="{{ asset('assetStudent/vendor/jquery-easing/jquery.easing.min.js') }}"></script>

    <title>Quiz</title>

{% block body %}
    <div  class="container">

        <div id="question">

        </div>
        <div id="answers">

        </div>
        <button onclick="sendAnswer()">send</button>
    </div>
{% endblock %}

{% block javascripts %}
    <script>

        const quizState = new EventSource('http://localhost:3000/.well-known/mercure?topic=quizState{{ quiz.id }}');
        state=0;
        quizState.onmessage = event => {
            if(event.data=='quizEnded'){
                $('div')[0].innerHTML='quiz ended';

            }
            else{

                state++;

                data=JSON.parse(event.data);
                $('#question')[0].innerHTML=data['question'];

              answers=data['answers'];

                answersDiv=' <div class="row">' +
                    '      <legend class="col-form-label col-sm-2 pt-0">Answers</legend>' +
                    '      <div class="col-sm-10">' ;


              answers.forEach((answer)=>{

                  answersDiv+= '        <div class="form-check">' +
                      '          <input class="answer-check" type="radio" name="gridRadios" id="answer'+answers.indexOf(answer)
                      +'" value="'+answers.indexOf(answer)  +'" checked>' +
                      '          <label class="form-check-label" for="gridRadios1">' +
                      answer +
                      '          </label>' +
                      '        </div>'
              });



                    answersDiv+='      </div></div>' ;


                $('#answers')[0].innerHTML=answersDiv;
            }




        }

        function sendAnswer(){
            $.ajax({


                url:'/student/quizAnswer/{{ quiz.id }}/'+state+'/'+$('.answer-check:checked').val(),
                method: 'POST',
                data: {

                    read: 1
                },
                success:(data)=>{
                    console.log(data);
                }
            });
        }



    </script>
{% endblock %}

